<!doctype html>
<html lang="en">

<head>
    <title>YOUR TITLE HERE</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS v5.0.2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.11.5/datatables.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

    <!-- Google fonts: https://fonts.google.com/icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="../static/css/style.css">
</head>

<body>



    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <!-- sidebar trigger -->
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
                <span class="navbar-toggler-icon"></span>
                <!-- sidebar trigger -->
            </button>

            <!-- Brand -->
            <a class="navbar-brand fw-bold me-auto" href="#" data-bs-target="#offcanvasExample">&nbsp; Home </a>


        </div>
    </nav>
    <!-- End Navbar -->

    <!-- Sidebar/offcanvas -->
    <div class="offcanvas offcanvas-start bg-dark text-white sidebar-nav" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
        <div class="offcanvas-body p-0">

            <!-- Secondary navbar -->
            <nav class="navbar-dark">
                <ul class="navbar-nav">
                    <!-- PUT LINKS HERE -->

                    <!-- Keep them in this format! (copy paste then change href, data-target, then the contents accordingly) -->
                    <li>
                        <!-- href and data-target: #element-to-view -->
                        <a href="/money-spent" class="nav-link px-3 active toggle-elements" data-toggle-class=".page" data-target="#money-spent">
                            <span class="me-2">
                                Money Spent
                            </span>
                        </a>
                    </li>
                    <li>
                        <!-- href and data-target: #element-to-view -->
                        <a href="/friends-list" class="nav-link px-3 active toggle-elements" data-toggle-class=".page" data-target="#friends-list">
                            <span class="me-2">
                                Friends List
                            </span>
                        </a>
                    </li>


                </ul>
            </nav>
        </div>
    </div>
    <!-- End Offcanvas -->

    <!-- Main part of the site -->
    <main class="mt-5 p-3">


        <!-- CREATE PAGES HERE! -->

        <!-- Be sure your links above correspond to the id here, notice #dashboard links to this element -->
        <div class="container page" id="money-spent">
            <!-- Make a page here -->

            <h1 class="text-center">Your Money Spent on Steam Games!</h1>
            <div class="form-outline">
                <input type="search" id="form1" class="form-control" placeholder="Enter Your Steam ID Here" aria-label="Search" />
            </div>
            <h2 class="text-center" id = "totalCost"> Find Total!</h2>

        </div>
        <div class="container page" id="friends-list">
            <!-- Make a page here -->

            <h1 class="text-center">Your Steam Friends!</h1>
            <div class="form-outline">
                <input type="search" id="form2" class="form-control" placeholder="Enter Your Steam ID Here" aria-label="Search" />
            </div>
            <table id="friendsTable" class="table table-striped table-hover">
                
            </table>
            <h2 class="text-center" id = "friendsButton"> Click Here!</h2>

        </div>

        <!-- For each page, make your links above -->


    </main>
    <!-- End of your pages, do not put any html content below this -->


    <!-- All scripts: -->

    <!-- Bootstrap JavaScript Libraries -->
    <!-- Popper -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>


    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.11.5/datatables.min.js"></script>


    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-trendline"></script>

    <!-- Taylor's scripts that you can use to your leisure! -->
    <script src="../static/js/requests.js"></script>
    <script src="../static/js/tables.js"></script>
    <script src="../static/js/elements.js"></script>
    <script src="../static/js/pages.js"></script>
    <script src="../static/js/script.js"></script>
    <script src="../static/js/notifications.js"></script>

    <!-- My Scripts! -->
    <script>
        //Total Game Money
        const button = document.querySelector('#totalCost');
        const results = document.querySelector('#totalCost');
        const inputForm = document.querySelector("#form1");
        button.addEventListener("click", (e) => {
            //results.innerHTML = "Loading!";
            findTotalForSteamId(inputForm.value).then((res) => {
                if (res == "private_profile") {
                    alert("Your Profile Is Private :(");
                    return; 
                }
                results.innerHTML = res;
            })  
        })
        /**
         * Tells you how much someone with the given steam id has spent on steam games
         * @param {String} steamId The steam id of the person
         * @returns {String}
         */
        async function findTotalForSteamId(steamId) {
            res = await fetch('/userMoney/' + steamId, { method:'POST' });
            text = await res.text();
            return text;
        }
        //Friends List
        const friendsButton = document.querySelector('#friendsButton');
        const friendsResults = document.querySelector('#friendsTable');
        const friendsInputForm = document.querySelector("#form2");
        const friendsHeaders = [
            {
                title:'Name',
                getData: (row) => {
                    return row.name
                }
            },
            {
                title: 'Id',
                getData: (row) => {
                    return row.steamid;
                }
            }
        ];
        friendsButton.addEventListener("click", (e) => {
            //friendsResults.innerHTML = "Loading!";
            findFriendsForSteamId(friendsInputForm.value)
                .then((res) => {
                    if (res == "private_profile") {
                        alert("Your Profile Is Private :(");
                        return; 
                    }
                    if (res == "error") {
                        alert("There was an error :|");
                        return; 
                    }
                    let people = JSON.parse(res)
                    let i = 0
                    for (let person of people) {
                        findInfoForSteamId(person.steamid) 
                        .then((info) => {
                            if (info == "private_profile") {
                                person.name = "Private Profile"
                            } else if (info == "error") {
                                person.name = "Error :/"
                            } else {
                                person.name = JSON.parse(info).response.players[0].personaname;
                            }
                            i++
                            if (i == people.length) {
                                setTable(friendsResults, friendsHeaders, people);
                                return;
                            }
                        })
                        .catch(e => {
                            console.error(e);
                        })             
                    }
                })
        })
        /**
         * Tells you how much someone with the given steam id has spent on steam games
         * @param {String} steamId The steam id of the person
         * @returns {String}
         */
        async function findFriendsForSteamId(steamId) {
            
            res = await fetch('/userFriends/' + steamId, { method:'POST' });
            text = await res.text();
            return text;
        }
        
        //User Info
        /**
         * Tells you how much someone with the given steam id has spent on steam games
         * @param {String} steamId The steam id of the person
         * @returns {String}
         */
        async function findInfoForSteamId(steamId) {
            
            res = await fetch('/userInfo/' + steamId, { method:'POST' });
            text = await res.text();
            return text;
        }
    </script>
</body>

</html>